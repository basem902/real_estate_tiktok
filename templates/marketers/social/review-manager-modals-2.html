<!-- نافذة طلب التقييمات -->
<div class="modal fade" id="requestReviewsModal" tabindex="-1" aria-labelledby="requestReviewsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="requestReviewsModalLabel">طلب تقييمات من العملاء</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted mb-4">أرسل رسائل إلى العملاء لتشجيعهم على تقييم خدماتك. يمكنك استهداف العملاء حسب فئات مختلفة.</p>
                
                <form id="requestReviewForm">
                    <div class="mb-3">
                        <label class="form-label">اختر المنصة</label>
                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="platform-google" checked>
                                    <label class="form-check-label" for="platform-google">
                                        <i class="fab fa-google me-1"></i> جوجل
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-3 mb-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="platform-facebook" checked>
                                    <label class="form-check-label" for="platform-facebook">
                                        <i class="fab fa-facebook me-1"></i> فيسبوك
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-3 mb-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="platform-booking">
                                    <label class="form-check-label" for="platform-booking">
                                        <i class="fas fa-building me-1"></i> منصة الحجز
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-3 mb-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="platform-web">
                                    <label class="form-check-label" for="platform-web">
                                        <i class="fas fa-globe me-1"></i> موقع الويب
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">قائمة العملاء</label>
                        <div class="row mb-2">
                            <div class="col-md-6">
                                <select class="form-select" id="customerSegment">
                                    <option value="recent" selected>العملاء الجدد (آخر 30 يوم)</option>
                                    <option value="repeat">العملاء المتكررين</option>
                                    <option value="high-value">العملاء ذوي القيمة العالية</option>
                                    <option value="all">جميع العملاء</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <select class="form-select" id="customerCount">
                                    <option value="10">10 عملاء</option>
                                    <option value="25" selected>25 عميل</option>
                                    <option value="50">50 عميل</option>
                                    <option value="100">100 عميل</option>
                                    <option value="all">جميع العملاء في القائمة</option>
                                </select>
                            </div>
                        </div>
                        <div class="alert alert-info small">
                            <i class="fas fa-info-circle me-1"></i>
                            سيتم استهداف العملاء الذين أكملوا معاملة في آخر 30 يومًا ولم يتركوا تقييمًا بعد.
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="messageSubject" class="form-label">عنوان الرسالة</label>
                        <input type="text" class="form-control" id="messageSubject" value="نقدر رأيك - قيّم تجربتك معنا">
                    </div>
                    
                    <div class="mb-3">
                        <label for="messageContent" class="form-label">محتوى الرسالة</label>
                        <textarea class="form-control" id="messageContent" rows="6">مرحباً {اسم_العميل}،

نشكرك على اختيارك لخدماتنا العقارية. يهمنا معرفة رأيك في تجربتك معنا.

هل يمكنك مساعدتنا من خلال تقييم خدماتنا؟ سيستغرق الأمر أقل من دقيقة، وستساعدنا آراؤك في تحسين خدماتنا.

{رابط_التقييم}

شكراً لوقتك ودعمك!

فريق الخدمات العقارية</textarea>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="deliveryMethod" class="form-label">طريقة الإرسال</label>
                            <select class="form-select" id="deliveryMethod">
                                <option value="email" selected>البريد الإلكتروني</option>
                                <option value="sms">رسالة نصية</option>
                                <option value="both">البريد الإلكتروني والرسائل النصية</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="scheduledTime" class="form-label">موعد الإرسال</label>
                            <select class="form-select" id="scheduledTime">
                                <option value="now" selected>الآن</option>
                                <option value="later">جدولة لوقت لاحق</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="scheduleDateContainer" class="mb-3 d-none">
                        <label for="scheduleDate" class="form-label">تاريخ ووقت الإرسال</label>
                        <input type="datetime-local" class="form-control" id="scheduleDate">
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="sendTestMessage">
                            <label class="form-check-label" for="sendTestMessage">
                                إرسال رسالة اختبار إلى بريدي الإلكتروني أولاً
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                <button type="submit" class="btn btn-primary" form="requestReviewForm">
                    <i class="fas fa-paper-plane me-1"></i>
                    إرسال طلبات التقييم
                </button>
            </div>
        </div>
    </div>
</div>

<!-- نافذة الإعدادات -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="settingsModalLabel">إعدادات إدارة التقييمات</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs" id="settingsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="auto-reply-tab" data-bs-toggle="tab" data-bs-target="#auto-reply" type="button" role="tab">الرد التلقائي</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notifications" type="button" role="tab">الإشعارات</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="display-tab" data-bs-toggle="tab" data-bs-target="#display" type="button" role="tab">خيارات العرض</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="templates-tab" data-bs-toggle="tab" data-bs-target="#templates" type="button" role="tab">قوالب الردود</button>
                    </li>
                </ul>
                <div class="tab-content p-3 border border-top-0 rounded-bottom" id="settingsTabsContent">
                    <!-- تبويب الرد التلقائي -->
                    <div class="tab-pane fade show active" id="auto-reply" role="tabpanel" aria-labelledby="auto-reply-tab">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="autoReplyEnabled" checked>
                            <label class="form-check-label" for="autoReplyEnabled">
                                تفعيل الرد التلقائي على التقييمات
                            </label>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">الرد تلقائياً على التقييمات التي تحمل:</label>
                            <div class="ms-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="autoReply5" checked>
                                    <label class="form-check-label" for="autoReply5">
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        (5 نجوم)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="autoReply4" checked>
                                    <label class="form-check-label" for="autoReply4">
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-muted"></i>
                                        (4 نجوم)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="autoReply3">
                                    <label class="form-check-label" for="autoReply3">
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-muted"></i>
                                        <i class="fas fa-star text-muted"></i>
                                        (3 نجوم)
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="template5stars" class="form-label">قالب الرد على تقييمات 5 نجوم:</label>
                            <select class="form-select" id="template5stars">
                                <option value="1" selected>رد إيجابي</option>
                                <option value="4">شكر على التفاصيل</option>
                                <option value="custom">تخصيص</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="template4stars" class="form-label">قالب الرد على تقييمات 4 نجوم:</label>
                            <select class="form-select" id="template4stars">
                                <option value="1" selected>رد إيجابي</option>
                                <option value="3">رد على تقييم متوسط</option>
                                <option value="4">شكر على التفاصيل</option>
                                <option value="custom">تخصيص</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="template3stars" class="form-label">قالب الرد على تقييمات 3 نجوم:</label>
                            <select class="form-select" id="template3stars">
                                <option value="3" selected>رد على تقييم متوسط</option>
                                <option value="2">رد على تقييم سلبي</option>
                                <option value="custom">تخصيص</option>
                            </select>
                        </div>
                        
                        <div class="alert alert-info small">
                            <i class="fas fa-info-circle me-1"></i>
                            التقييمات أقل من 3 نجوم ستظهر في قائمة "تحتاج إلى مراجعة" وتتطلب رداً يدوياً.
                        </div>
                    </div>
                    
                    <!-- تبويب الإشعارات -->
                    <div class="tab-pane fade" id="notifications" role="tabpanel" aria-labelledby="notifications-tab">
                        <div class="mb-3">
                            <label class="form-label">إرسال إشعارات عند:</label>
                            <div class="ms-4">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="notifyNewReview" checked>
                                    <label class="form-check-label" for="notifyNewReview">
                                        استلام تقييم جديد
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="notifyNegativeReview" checked>
                                    <label class="form-check-label" for="notifyNegativeReview">
                                        استلام تقييم سلبي (أقل من 3 نجوم)
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="notifyUnreplied" checked>
                                    <label class="form-check-label" for="notifyUnreplied">
                                        وجود تقييمات بدون رد لأكثر من:
                                    </label>
                                    <div class="ms-4 mt-2">
                                        <select class="form-select form-select-sm w-auto" id="unrepliedHours">
                                            <option value="4">4 ساعات</option>
                                            <option value="12">12 ساعة</option>
                                            <option value="24" selected>24 ساعة</option>
                                            <option value="48">48 ساعة</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">طرق الإشعار:</label>
                            <div class="ms-4">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="notifyDashboard" checked>
                                    <label class="form-check-label" for="notifyDashboard">
                                        إشعارات لوحة التحكم
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="notifyEmail" checked>
                                    <label class="form-check-label" for="notifyEmail">
                                        البريد الإلكتروني
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="notifyMobile">
                                    <label class="form-check-label" for="notifyMobile">
                                        إشعارات تطبيق الجوال
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="notifyEmails" class="form-label">إرسال الإشعارات إلى البريد الإلكتروني:</label>
                            <input type="email" class="form-control" id="notifyEmails" placeholder="أدخل عناوين البريد الإلكتروني مفصولة بفواصل">
                            <div class="form-text">
                                يمكنك إضافة عدة عناوين بريد إلكتروني مفصولة بفواصل.
                            </div>
                        </div>
                    </div>
                    
                    <!-- تبويب خيارات العرض -->
                    <div class="tab-pane fade" id="display" role="tabpanel" aria-labelledby="display-tab">
                        <div class="mb-3">
                            <label for="defaultSort" class="form-label">الترتيب الافتراضي للتقييمات:</label>
                            <select class="form-select" id="defaultSort">
                                <option value="date" selected>الأحدث أولاً</option>
                                <option value="rating-asc">التقييم (الأقل إلى الأعلى)</option>
                                <option value="rating-desc">التقييم (الأعلى إلى الأقل)</option>
                                <option value="unreplied">التقييمات بدون رد أولاً</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="defaultFilter" class="form-label">الفلتر الافتراضي للتقييمات:</label>
                            <select class="form-select" id="defaultFilter">
                                <option value="all" selected>جميع التقييمات</option>
                                <option value="unreplied">التقييمات بدون رد</option>
                                <option value="positive">التقييمات الإيجابية (4-5 نجوم)</option>
                                <option value="negative">التقييمات السلبية (1-3 نجوم)</option>
                                <option value="flagged">التقييمات المميزة</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="reviewsPerPage" class="form-label">عدد التقييمات في كل صفحة:</label>
                            <select class="form-select" id="reviewsPerPage">
                                <option value="5">5 تقييمات</option>
                                <option value="10" selected>10 تقييمات</option>
                                <option value="20">20 تقييم</option>
                                <option value="50">50 تقييم</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="dateFormat" class="form-label">تنسيق عرض التاريخ:</label>
                            <select class="form-select" id="dateFormat">
                                <option value="full" selected>كامل (22 مارس 2025، 10:30 ص)</option>
                                <option value="date">التاريخ فقط (22 مارس 2025)</option>
                                <option value="relative">نسبي (منذ 3 أيام)</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="showAnalyticsSummary" checked>
                                <label class="form-check-label" for="showAnalyticsSummary">
                                    عرض ملخص التحليلات في الصفحة الرئيسية
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="showTopReviews" checked>
                                <label class="form-check-label" for="showTopReviews">
                                    عرض قسم "التقييمات المميزة"
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- تبويب قوالب الردود -->
                    <div class="tab-pane fade" id="templates" role="tabpanel" aria-labelledby="templates-tab">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0">قوالب الردود المتاحة</h6>
                            <button class="btn btn-sm btn-primary" id="addNewTemplate">
                                <i class="fas fa-plus me-1"></i> إضافة قالب جديد
                            </button>
                        </div>
                        
                        <div class="list-group mb-3" id="templatesList">
                            <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>رد إيجابي</strong>
                                    <p class="mb-0 small text-muted">شكراً لك على تقييمك الإيجابي! نحن سعداء بأنك استفدت من خدماتنا...</p>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-secondary me-1" title="تعديل">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" title="حذف">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>رد على تقييم سلبي</strong>
                                    <p class="mb-0 small text-muted">شكراً على ملاحظاتك. نأسف لتجربتك غير المرضية ونود التواصل معك...</p>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-secondary me-1" title="تعديل">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" title="حذف">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>رد على تقييم متوسط</strong>
                                    <p class="mb-0 small text-muted">نشكرك على تقييمك ونقدر ملاحظاتك. سنأخذ اقتراحاتك بعين الاعتبار...</p>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-secondary me-1" title="تعديل">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" title="حذف">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="newTemplateForm" class="border rounded p-3 d-none">
                            <h6 class="mb-3">إضافة قالب جديد</h6>
                            <div class="mb-3">
                                <label for="templateName" class="form-label">اسم القالب</label>
                                <input type="text" class="form-control" id="templateName" placeholder="أدخل اسماً للقالب">
                            </div>
                            <div class="mb-3">
                                <label for="templateIcon" class="form-label">الأيقونة</label>
                                <select class="form-select" id="templateIcon">
                                    <option value="fas fa-thumbs-up" selected>إبهام لأعلى</option>
                                    <option value="fas fa-thumbs-down">إبهام لأسفل</option>
                                    <option value="fas fa-star">نجمة</option>
                                    <option value="fas fa-heart">قلب</option>
                                    <option value="fas fa-info-circle">معلومات</option>
                                    <option value="fas fa-exclamation-circle">تنبيه</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="templateContent" class="form-label">المحتوى</label>
                                <textarea class="form-control" id="templateContent" rows="4" placeholder="أدخل محتوى القالب"></textarea>
                                <div class="form-text">
                                    يمكنك استخدام {اسم_العميل} كمتغير ليتم استبداله باسم العميل.
                                </div>
                            </div>
                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn btn-outline-secondary me-2" id="cancelTemplate">إلغاء</button>
                                <button type="button" class="btn btn-primary" id="saveTemplate">حفظ القالب</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                <button type="button" class="btn btn-primary" id="saveSettings">حفظ الإعدادات</button>
            </div>
        </div>
    </div>
</div>
