<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحليلات | المسوقين العقاريين</title>
    <link rel="stylesheet" href="../assets/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="../assets/css/all.min.css">
    <link rel="stylesheet" href="styles/analytics_dashboard.css">
</head>
<body>
    <!-- شريط التنقل العلوي -->
    <div id="navbar-placeholder"></div>

    <div class="container-fluid my-4">
        <div class="row">
            <!-- القائمة الجانبية -->
            <div class="col-lg-2 mb-4">
                <div id="sidebar-placeholder"></div>
            </div>

            <!-- المحتوى الرئيسي -->
            <div class="col-lg-10">
                <div class="row">
                    <div class="col-12">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">لوحة التحليلات</h5>
                                <div>
                                    <button class="btn btn-sm btn-light" id="refresh-analytics"><i class="fas fa-sync-alt"></i></button>
                                    <button class="btn btn-sm btn-light" id="export-analytics"><i class="fas fa-file-export"></i></button>
                                    <button class="btn btn-sm btn-light" id="settings-analytics"><i class="fas fa-cog"></i></button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- فلاتر التحليلات -->
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">فلترة وتخصيص</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-3">
                                                <label class="form-label">الفترة الزمنية</label>
                                                <select class="form-select" id="time-period">
                                                    <option value="week">آخر أسبوع</option>
                                                    <option value="month" selected>آخر شهر</option>
                                                    <option value="quarter">آخر ربع سنة</option>
                                                    <option value="year">آخر سنة</option>
                                                    <option value="custom">تخصيص...</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">مقارنة مع</label>
                                                <select class="form-select" id="comparison-period">
                                                    <option value="none">بدون مقارنة</option>
                                                    <option value="previous">الفترة السابقة</option>
                                                    <option value="last-year">نفس الفترة من العام الماضي</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">العقارات</label>
                                                <select class="form-select" id="property-filter">
                                                    <option value="all">جميع العقارات</option>
                                                    <option value="apartments">الشقق فقط</option>
                                                    <option value="villas">الفلل فقط</option>
                                                    <option value="lands">الأراضي فقط</option>
                                                    <option value="commercial">العقارات التجارية فقط</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">تجميع البيانات</label>
                                                <select class="form-select" id="data-grouping">
                                                    <option value="day">يومي</option>
                                                    <option value="week">أسبوعي</option>
                                                    <option value="month" selected>شهري</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- مؤشرات الأداء الرئيسية -->
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <div class="card border-0 bg-light h-100">
                                            <div class="card-body text-center">
                                                <h3 class="text-primary mb-0">4.2</h3>
                                                <p class="text-muted">متوسط التقييم</p>
                                                <div class="small text-success"><i class="fas fa-arrow-up"></i> +0.3</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card border-0 bg-light h-100">
                                            <div class="card-body text-center">
                                                <h3 class="text-primary mb-0">82%</h3>
                                                <p class="text-muted">معدل الرضا</p>
                                                <div class="small text-success"><i class="fas fa-arrow-up"></i> +5%</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card border-0 bg-light h-100">
                                            <div class="card-body text-center">
                                                <h3 class="text-primary mb-0">68</h3>
                                                <p class="text-muted">عدد التقييمات</p>
                                                <div class="small text-success"><i class="fas fa-arrow-up"></i> +12</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card border-0 bg-light h-100">
                                            <div class="card-body text-center">
                                                <h3 class="text-primary mb-0">95%</h3>
                                                <p class="text-muted">معدل الاستجابة</p>
                                                <div class="small text-success"><i class="fas fa-arrow-up"></i> +3%</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- الرسوم البيانية الرئيسية -->
                                <div class="row mb-4">
                                    <div class="col-md-8">
                                        <div class="card shadow-sm h-100">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0">تطور التقييمات خلال الفترة</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="chart-container" style="position: relative; height:400px;">
                                                    <canvas id="ratings-trend-chart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card shadow-sm h-100">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0">توزيع التقييمات حسب المعايير</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="chart-container" style="position: relative; height:400px;">
                                                    <canvas id="criteria-radar-chart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- تحليل المشاعر والكلمات -->
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="card shadow-sm h-100">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0">تحليل المشاعر في التعليقات</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="chart-container" style="position: relative; height:300px;">
                                                    <canvas id="sentiment-chart"></canvas>
                                                </div>
                                                <div class="mt-3">
                                                    <h6>أهم النقاط الإيجابية:</h6>
                                                    <ul class="text-success">
                                                        <li>الموقع ممتاز وقريب من الخدمات</li>
                                                        <li>مستوى الخدمة والاحترافية للمسوقين</li>
                                                        <li>جودة التشطيبات والمواد المستخدمة</li>
                                                    </ul>
                                                    <h6>أهم النقاط السلبية:</h6>
                                                    <ul class="text-danger">
                                                        <li>ارتفاع الأسعار مقارنة بالقيمة</li>
                                                        <li>بعض مشاكل الصيانة والتكييف</li>
                                                        <li>المساحات الخارجية محدودة</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card shadow-sm h-100">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0">سحابة الكلمات الشائعة</h6>
                                            </div>
                                            <div class="card-body text-center">
                                                <div id="word-cloud" style="height:300px;">
                                                    <!-- ستتم إضافة سحابة الكلمات ديناميكيًا -->
                                                    <img src="../assets/img/word-cloud-sample.png" class="img-fluid" alt="سحابة الكلمات">
                                                </div>
                                                <div class="mt-3">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <span class="text-primary fw-bold">الموقع</span>
                                                        <div class="progress flex-grow-1 ms-2" style="height:10px;">
                                                            <div class="progress-bar bg-primary" style="width:85%"></div>
                                                        </div>
                                                        <span class="ms-2">85%</span>
                                                    </div>
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <span class="text-primary fw-bold">السعر</span>
                                                        <div class="progress flex-grow-1 ms-2" style="height:10px;">
                                                            <div class="progress-bar bg-primary" style="width:78%"></div>
                                                        </div>
                                                        <span class="ms-2">78%</span>
                                                    </div>
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <span class="text-primary fw-bold">الجودة</span>
                                                        <div class="progress flex-grow-1 ms-2" style="height:10px;">
                                                            <div class="progress-bar bg-primary" style="width:72%"></div>
                                                        </div>
                                                        <span class="ms-2">72%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- مقارنة الأداء -->
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">مقارنة التقييمات حسب نوع العقار</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container" style="position: relative; height:300px;">
                                            <canvas id="property-comparison-chart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- توصيات التحسين -->
                                <div class="card shadow-sm">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">توصيات التحسين الذكية</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="alert alert-info">
                                            <h6 class="mb-2"><i class="fas fa-lightbulb"></i> تحليل البيانات يشير إلى فرص التحسين التالية:</h6>
                                            <ol>
                                                <li>مراجعة سياسة التسعير للشقق في منطقة شمال الرياض حيث تظهر معظم التعليقات السلبية.</li>
                                                <li>تحسين معلومات الموقع والخدمات المحيطة في عروض العقارات، فهي من أهم العوامل المؤثرة.</li>
                                                <li>إجراء تدريب إضافي للمسوقين في التعامل مع استفسارات العملاء حول جودة البناء والتشطيبات.</li>
                                                <li>توفير مزيد من الصور والفيديوهات عالية الجودة للمساحات الداخلية، فهي محل إشادة في معظم التقييمات.</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- تذييل الصفحة -->
    <div id="footer-placeholder"></div>

    <!-- نوافذ الحوار -->
    <div class="modal fade" id="custom-date-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">تخصيص نطاق التاريخ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">من تاريخ</label>
                            <input type="date" class="form-control" id="date-from">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">إلى تاريخ</label>
                            <input type="date" class="form-control" id="date-to">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" id="apply-date-range">تطبيق</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="analytics-settings-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إعدادات التحليلات</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">عرض المخططات</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="show-trend-chart" checked>
                            <label class="form-check-label" for="show-trend-chart">مخطط تطور التقييمات</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="show-radar-chart" checked>
                            <label class="form-check-label" for="show-radar-chart">مخطط المعايير</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="show-sentiment-chart" checked>
                            <label class="form-check-label" for="show-sentiment-chart">تحليل المشاعر</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="show-word-cloud" checked>
                            <label class="form-check-label" for="show-word-cloud">سحابة الكلمات</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="show-property-comparison" checked>
                            <label class="form-check-label" for="show-property-comparison">مقارنة أنواع العقارات</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">نوع المخطط</label>
                        <select class="form-select" id="chart-type">
                            <option value="line">خطي</option>
                            <option value="bar">شريطي</option>
                            <option value="area">مساحي</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" id="save-settings">حفظ الإعدادات</button>
                </div>
            </div>
        </div>
    </div>

    <!-- سكريبت التحليلات -->
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/chart.min.js"></script>
    <script src="../assets/js/d3.min.js"></script>
    <script src="../assets/js/d3.layout.cloud.min.js"></script>
    <script src="js/AnalyticsService.js"></script>
    <script src="js/ChartRenderer.js"></script>
    <script>
        // تحميل المكونات المشتركة
        $(function () {
            $("#navbar-placeholder").load("../includes/navbar.html");
            $("#sidebar-placeholder").load("../includes/sidebar.html");
            $("#footer-placeholder").load("../includes/footer.html");
            
            // تهيئة لوحة التحليلات
            initAnalyticsDashboard();
            
            // استمع إلى تغييرات الفلاتر
            $("#time-period").on("change", function() {
                if ($(this).val() === "custom") {
                    $("#custom-date-modal").modal("show");
                } else {
                    refreshCharts();
                }
            });
            
            $("#comparison-period, #property-filter, #data-grouping").on("change", function() {
                refreshCharts();
            });
            
            // تعيين عمل زر التحديث
            $("#refresh-analytics").on("click", refreshCharts);
            
            // تعيين عمل زر الإعدادات
            $("#settings-analytics").on("click", function() {
                $("#analytics-settings-modal").modal("show");
            });
            
            // تطبيق نطاق التاريخ المخصص
            $("#apply-date-range").on("click", function() {
                $("#custom-date-modal").modal("hide");
                refreshCharts();
            });
            
            // حفظ إعدادات التحليلات
            $("#save-settings").on("click", function() {
                $("#analytics-settings-modal").modal("hide");
                refreshCharts();
            });
        });

        function initAnalyticsDashboard() {
            // تهيئة المخططات والتحليلات
            console.log("تهيئة لوحة التحليلات");
            
            // تهيئة مخطط تطور التقييمات
            initRatingsTrendChart();
            
            // تهيئة مخطط الرادار للمعايير
            initCriteriaRadarChart();
            
            // تهيئة مخطط تحليل المشاعر
            initSentimentChart();
            
            // تهيئة مخطط مقارنة العقارات
            initPropertyComparisonChart();
        }
        
        function refreshCharts() {
            console.log("تحديث المخططات والبيانات");
            // سيتم هنا إعادة تحميل البيانات وتحديث جميع المخططات
        }
        
        function initRatingsTrendChart() {
            // هذه دالة مثال لتهيئة مخطط تطور التقييمات
            console.log("تهيئة مخطط تطور التقييمات");
        }
        
        function initCriteriaRadarChart() {
            // هذه دالة مثال لتهيئة مخطط الرادار للمعايير
            console.log("تهيئة مخطط معايير التقييم");
        }
        
        function initSentimentChart() {
            // هذه دالة مثال لتهيئة مخطط تحليل المشاعر
            console.log("تهيئة مخطط تحليل المشاعر");
        }
        
        function initPropertyComparisonChart() {
            // هذه دالة مثال لتهيئة مخطط مقارنة العقارات
            console.log("تهيئة مخطط مقارنة العقارات");
        }
    </script>
</body>
</html>
