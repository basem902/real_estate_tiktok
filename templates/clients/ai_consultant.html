<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المستشار العقاري الذكي - تيك توك العقاري</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        :root {
            --primary-color: #2196F3;
            --secondary-color: #FFC107;
            --dark-color: #f8f9fa;
            --light-color: #333;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f5f5f5;
            color: var(--light-color);
            padding-bottom: 70px;
        }
        
        body.dark-mode {
            background-color: #222;
            color: var(--dark-color);
        }
        
        .container {
            max-width: 1200px;
            padding-top: 20px;
        }
        
        /* هيدر الصفحة */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .header-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }
        
        .header-actions {
            display: flex;
        }
        
        .back-button, .mode-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: transparent;
            margin-right: 10px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .back-button:hover, .mode-toggle:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        body.dark-mode .back-button:hover, body.dark-mode .mode-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* تنسيقات الواجهة */
        .ai-consultant-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 120px);
        }
        
        .chat-container {
            flex-grow: 1;
            display: flex;
            background-color: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        body.dark-mode .chat-container {
            background-color: #333;
        }
        
        .sidebar {
            width: 300px;
            background-color: #f8f9fa;
            border-left: 1px solid #e9ecef;
            padding: 20px;
            overflow-y: auto;
        }
        
        body.dark-mode .sidebar {
            background-color: #2a2a2a;
            border-left: 1px solid #444;
        }
        
        .chat-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .chat-input {
            padding: 15px;
            border-top: 1px solid #e9ecef;
            background-color: #fff;
        }
        
        body.dark-mode .chat-input {
            background-color: #333;
            border-top: 1px solid #444;
        }
        
        .input-container {
            display: flex;
            align-items: center;
        }
        
        .message-input {
            flex-grow: 1;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            padding: 10px 15px;
            outline: none;
            transition: var(--transition);
        }
        
        body.dark-mode .message-input {
            background-color: #444;
            border: 1px solid #555;
            color: #fff;
        }
        
        .message-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.25);
        }
        
        .send-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .send-button:hover {
            background-color: #0b7dda;
        }
        
        /* تنسيقات الرسائل */
        .message {
            margin-bottom: 15px;
            max-width: 80%;
        }
        
        .user-message {
            margin-right: auto;
            background-color: #e9f5ff;
            border-radius: 15px 15px 0 15px;
            padding: 10px 15px;
        }
        
        body.dark-mode .user-message {
            background-color: #0d324d;
        }
        
        .ai-message {
            margin-left: auto;
            background-color: #f0f2f5;
            border-radius: 15px 15px 15px 0;
            padding: 10px 15px;
        }
        
        body.dark-mode .ai-message {
            background-color: #3a3a3a;
        }
        
        .message-time {
            font-size: 0.75rem;
            color: #aaa;
            margin-top: 5px;
        }
        
        .ai-suggestion {
            background-color: #fff;
            border: 1px solid #e9ecef;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        body.dark-mode .ai-suggestion {
            background-color: #333;
            border: 1px solid #444;
        }
        
        .ai-suggestion:hover {
            border-color: var(--primary-color);
            box-shadow: var(--box-shadow);
        }
        
        .ai-suggestion-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .ai-suggestion-description {
            font-size: 0.9rem;
            color: #777;
        }
        
        body.dark-mode .ai-suggestion-description {
            color: #aaa;
        }
        
        /* تنسيقات البطاقات */
        .property-suggestion {
            background-color: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        body.dark-mode .property-suggestion {
            background-color: #333;
        }
        
        .property-image {
            height: 150px;
            background-size: cover;
            background-position: center;
        }
        
        .property-details {
            padding: 10px 15px;
        }
        
        .property-price {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        body.dark-mode .property-price {
            color: #5eb3f6;
        }
        
        .property-features {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            color: #777;
            font-size: 0.9rem;
        }
        
        body.dark-mode .property-features {
            color: #aaa;
        }
        
        .property-actions {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            border-top: 1px solid #e9ecef;
        }
        
        body.dark-mode .property-actions {
            border-top: 1px solid #444;
        }
        
        /* تنسيقات الأزرار */
        .button-group {
            display: flex;
            margin-bottom: 15px;
        }
        
        .filter-button {
            flex-grow: 1;
            padding: 8px;
            text-align: center;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            cursor: pointer;
            transition: var(--transition);
        }
        
        body.dark-mode .filter-button {
            background-color: #2a2a2a;
            border: 1px solid #444;
        }
        
        .filter-button:first-child {
            border-radius: var(--border-radius) 0 0 var(--border-radius);
        }
        
        .filter-button:last-child {
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }
        
        .filter-button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* تنسيقات متنوعة */
        .section-title {
            position: relative;
            padding-right: 15px;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .section-title::before {
            content: "";
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 5px;
            height: 20px;
            background-color: var(--primary-color);
            border-radius: 3px;
        }
        
        .tag {
            display: inline-block;
            background-color: #e9f5ff;
            color: var(--primary-color);
            border-radius: 15px;
            padding: 3px 10px;
            font-size: 0.8rem;
            margin-left: 5px;
            margin-bottom: 5px;
        }
        
        body.dark-mode .tag {
            background-color: #0d324d;
        }
        
        .ai-thinking {
            display: flex;
            align-items: center;
            color: #777;
            font-style: italic;
            padding: 10px;
        }
        
        body.dark-mode .ai-thinking {
            color: #aaa;
        }
        
        .loading-dots {
            display: flex;
            margin-right: 10px;
        }
        
        .loading-dots span {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background-color: #777;
            margin-left: 3px;
            animation: loading 1.4s infinite ease-in-out both;
        }
        
        body.dark-mode .loading-dots span {
            background-color: #aaa;
        }
        
        .loading-dots span:nth-child(1) {
            animation-delay: 0.2s;
        }
        
        .loading-dots span:nth-child(2) {
            animation-delay: 0.4s;
        }
        
        .loading-dots span:nth-child(3) {
            animation-delay: 0.6s;
        }
        
        @keyframes loading {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }
        
        @media (max-width: 768px) {
            .chat-container {
                flex-direction: column-reverse;
            }
            
            .sidebar {
                width: 100%;
                height: 200px;
                border-left: none;
                border-top: 1px solid #e9ecef;
            }
            
            body.dark-mode .sidebar {
                border-top: 1px solid #444;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- هيدر الصفحة -->
        <div class="page-header">
            <h1 class="header-title">المستشار العقاري الذكي</h1>
            <div class="header-actions">
                <button class="mode-toggle" aria-label="تبديل الوضع">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="back-button" aria-label="العودة">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <div class="ai-consultant-container">
            <div class="chat-container">
                <!-- منطقة الدردشة -->
                <div class="chat-area">
                    <div class="chat-messages" id="chat-messages">
                        <!-- رسائل الترحيب من المستشار الذكي -->
                        <div class="message ai-message">
                            <div class="message-content">
                                <p>مرحباً بك في المستشار العقاري الذكي! أنا هنا لمساعدتك في رحلة البحث عن العقار المناسب.</p>
                                <p>كيف يمكنني مساعدتك اليوم؟</p>
                            </div>
                            <div class="message-time">الآن</div>
                        </div>
                        
                        <div class="ai-thinking" id="ai-thinking" style="display: none;">
                            <div class="loading-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                            <div>المستشار يفكر...</div>
                        </div>
                    </div>
                    
                    <div class="chat-input">
                        <div class="input-container">
                            <button class="send-button" id="send-button">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                            <input type="text" class="message-input" id="message-input" placeholder="اكتب سؤالك هنا..." autocomplete="off">
                        </div>
                    </div>
                </div>
                
                <!-- الشريط الجانبي -->
                <div class="sidebar">
                    <!-- أزرار التصفية -->
                    <div class="button-group">
                        <div class="filter-button active" data-filter="suggestions">اقتراحات</div>
                        <div class="filter-button" data-filter="properties">عقارات موصى بها</div>
                    </div>
                    
                    <!-- قسم الاقتراحات -->
                    <div class="suggestions-section" id="suggestions-section">
                        <h3 class="section-title">أسئلة مقترحة</h3>
                        
                        <div class="ai-suggestion" data-query="ما هي أفضل المناطق للسكن في الرياض للعائلات؟">
                            <div class="ai-suggestion-title">أفضل المناطق للعائلات</div>
                            <div class="ai-suggestion-description">اكتشف المناطق الأنسب للعائلات في الرياض</div>
                        </div>
                        
                        <div class="ai-suggestion" data-query="كيف أقيّم إذا كان سعر العقار مناسب؟">
                            <div class="ai-suggestion-title">تقييم أسعار العقارات</div>
                            <div class="ai-suggestion-description">نصائح لمعرفة ما إذا كان سعر العقار عادلاً</div>
                        </div>
                        
                        <div class="ai-suggestion" data-query="ما هي الأمور التي يجب التحقق منها قبل شراء عقار قديم؟">
                            <div class="ai-suggestion-title">فحص العقارات القديمة</div>
                            <div class="ai-suggestion-description">قائمة تحقق قبل شراء عقار مستعمل</div>
                        </div>
                        
                        <div class="ai-suggestion" data-query="هل الاستثمار العقاري مناسب لي؟">
                            <div class="ai-suggestion-title">الاستثمار العقاري</div>
                            <div class="ai-suggestion-description">تعرف على مدى ملاءمة الاستثمار العقاري لظروفك</div>
                        </div>
                        
                        <div class="ai-suggestion" data-query="ما الفرق بين التمويل العقاري التقليدي والإسلامي؟">
                            <div class="ai-suggestion-title">أنواع التمويل العقاري</div>
                            <div class="ai-suggestion-description">مقارنة بين خيارات التمويل المختلفة</div>
                        </div>
                    </div>
                    
                    <!-- قسم العقارات الموصى بها -->
                    <div class="properties-section" id="properties-section" style="display: none;">
                        <h3 class="section-title">اقتراحات بناءً على تفضيلاتك</h3>
                        
                        <div class="property-suggestion">
                            <div class="property-image" style="background-image: url('https://via.placeholder.com/300x150');"></div>
                            <div class="property-details">
                                <div class="property-title">فيلا فاخرة في حي النرجس</div>
                                <div class="property-price">2,100,000 ر.س</div>
                                <div class="property-features">
                                    <span><i class="fas fa-ruler-combined"></i> 450م²</span>
                                    <span><i class="fas fa-bed"></i> 5 غرف</span>
                                    <span><i class="fas fa-bath"></i> 4 حمامات</span>
                                </div>
                            </div>
                            <div class="property-actions">
                                <button class="btn btn-sm btn-outline-primary view-property-btn">عرض التفاصيل</button>
                                <button class="btn btn-sm btn-outline-secondary ask-about-btn">اسأل عنها</button>
                            </div>
                        </div>
                        
                        <div class="property-suggestion">
                            <div class="property-image" style="background-image: url('https://via.placeholder.com/300x150');"></div>
                            <div class="property-details">
                                <div class="property-title">شقة حديثة في حي الياسمين</div>
                                <div class="property-price">850,000 ر.س</div>
                                <div class="property-features">
                                    <span><i class="fas fa-ruler-combined"></i> 180م²</span>
                                    <span><i class="fas fa-bed"></i> 3 غرف</span>
                                    <span><i class="fas fa-bath"></i> 2 حمامات</span>
                                </div>
                            </div>
                            <div class="property-actions">
                                <button class="btn btn-sm btn-outline-primary view-property-btn">عرض التفاصيل</button>
                                <button class="btn btn-sm btn-outline-secondary ask-about-btn">اسأل عنها</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- المكتبات المطلوبة -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // العناصر الرئيسية في الصفحة
        const chatMessages = document.getElementById('chat-messages');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const aiThinking = document.getElementById('ai-thinking');
        const suggestionsSection = document.getElementById('suggestions-section');
        const propertiesSection = document.getElementById('properties-section');
        const filterButtons = document.querySelectorAll('.filter-button');
        const aiSuggestions = document.querySelectorAll('.ai-suggestion');
        const modeToggle = document.querySelector('.mode-toggle');
        
        // قاعدة المعرفة البسيطة للردود
        const knowledgeBase = {
            'ما هي أفضل المناطق للسكن في الرياض للعائلات': 
                `بناءً على بيانات المبيعات والرضا السكني، تعتبر الأحياء التالية من أفضل المناطق للعائلات في الرياض:
                
                1. <span class="tag">حي النرجس</span> - يتميز بالهدوء والمساحات الخضراء والقرب من المدارس الجيدة
                2. <span class="tag">حي الياسمين</span> - خيار ممتاز للعائلات مع أطفال بسبب الخدمات المتكاملة
                3. <span class="tag">حي الملقا</span> - يجمع بين الموقع المتميز والبنية التحتية الحديثة
                4. <span class="tag">حي الربيع</span> - معروف بالأمان والخدمات المتكاملة
                
                هل تبحث عن مميزات محددة في المنطقة السكنية؟`,
                
            'كيف أقيّم إذا كان سعر العقار مناسب': 
                `لتقييم مدى مناسبة سعر العقار، يمكنك اتباع هذه الخطوات:
                
                1. <b>مقارنة السوق</b>: ابحث عن عقارات مماثلة تم بيعها مؤخراً في نفس المنطقة
                2. <b>التكلفة لكل متر مربع</b>: احسب واقارن مع متوسط المنطقة
                3. <b>حالة العقار</b>: قيم الصيانة المطلوبة والتكاليف المستقبلية
                4. <b>الموقع</b>: قرب الخدمات والمدارس ووسائل النقل يؤثر على القيمة
                
                هل ترغب في مساعدتك في تقييم عقار محدد؟`,
                
            'ما هي الأمور التي يجب التحقق منها قبل شراء عقار قديم': 
                `عند شراء عقار قديم، يجب التحقق من:
                
                1. <b>حالة الأساسات والهيكل</b>: ابحث عن تشققات أو مشاكل إنشائية
                2. <b>السباكة والكهرباء</b>: تأكد من سلامتها وتحديثها
                3. <b>الرطوبة والتسربات</b>: افحص السقف والجدران جيداً
                4. <b>العزل الحراري</b>: يؤثر على فواتير الكهرباء
                5. <b>التاريخ الإنشائي</b>: اسأل عن أعمال الصيانة السابقة
                6. <b>الصكوك والوثائق</b>: تأكد من سلامة الأوراق قانونياً
                
                أنصح بالاستعانة بمهندس مختص للفحص قبل الشراء. هل تخطط لشراء عقار قريباً؟`,
                
            'هل الاستثمار العقاري مناسب لي': 
                `الاستثمار العقاري يعتبر من أكثر الاستثمارات أماناً على المدى الطويل. أنصح بالبحث عن مناطق نامية حيث من المتوقع ارتفاع قيمة العقارات مستقبلاً.`,
                
            'ما الفرق بين التمويل العقاري التقليدي والإسلامي': 
                `الفروق الرئيسية بين التمويل العقاري التقليدي والإسلامي:
                
                <b>التمويل التقليدي:</b>
                - يعتمد على القروض بفائدة ثابتة أو متغيرة
                - ملكية العقار تنتقل للمشتري مباشرة
                - غرامات تأخير في حال التأخر عن السداد
                
                <b>التمويل الإسلامي:</b>
                - يعتمد على صيغ مثل المرابحة أو الإجارة المنتهية بالتمليك
                - البنك يشتري العقار ثم يبيعه للعميل بهامش ربح معلوم
                - لا توجد فوائد تأخير لكن قد تكون هناك غرامات تذهب للأعمال الخيرية
                
                من الناحية العملية، التكلفة الإجمالية قد تكون متقاربة، لكن الفرق في الهيكلة والالتزام بالضوابط الشرعية. هل تحتاج إلى معلومات عن برامج تمويل محددة؟`
        };
        
        // مصفوفة الردود العامة للاستفسارات غير المحددة
        const genericResponses = [
            "بناءً على خبرتي في سوق العقارات، يمكنني تقديم النصيحة التالية: ",
            "من منظور استشاري، أقترح عليك: ",
            "استناداً إلى اتجاهات السوق الحالية، أنصح بما يلي: ",
            "بعد تحليل بيانات السوق العقاري، يمكنني القول أن: ",
            "وفقاً لتجارب المشترين السابقين، من المهم أن تعلم أن: "
        ];
        
        // إضافة رسالة جديدة من المستخدم
        function addUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message user-message';
            messageElement.innerHTML = `
                <div class="message-content">${message}</div>
                <div class="message-time">الآن</div>
            `;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // إضافة رسالة جديدة من المستشار الذكي
        function addAIMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message ai-message';
            messageElement.innerHTML = `
                <div class="message-content">${message}</div>
                <div class="message-time">الآن</div>
            `;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // محاكاة المستشار العقاري الذكي
        function simulateAIResponse(message) {
            // عرض مؤشر التفكير
            aiThinking.style.display = 'flex';
            
            // تأخير للمحاكاة
            setTimeout(() => {
                // إخفاء مؤشر التفكير
                aiThinking.style.display = 'none';
                
                // البحث في قاعدة المعرفة عن إجابة مطابقة
                let response = '';
                
                // تبسيط المقارنة عن طريق إزالة علامات الترقيم والمسافات الزائدة
                const normalizedMessage = message.toLowerCase()
                    .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g, '')
                    .replace(/\s+/g, ' ')
                    .trim();
                
                // البحث عن كلمات رئيسية في الرسالة
                for (const [key, value] of Object.entries(knowledgeBase)) {
                    const normalizedKey = key.toLowerCase()
                        .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g, '')
                        .replace(/\s+/g, ' ')
                        .trim();
                        
                    if (normalizedMessage.includes(normalizedKey) || 
                        normalizedKey.includes(normalizedMessage) || 
                        (normalizedMessage.length > 4 && levenshteinDistance(normalizedMessage, normalizedKey) < 10)) {
                        response = value;
                        break;
                    }
                }
                
                // إذا لم يتم العثور على إجابة مطابقة، استخدم رداً عاماً
                if (!response) {
                    const randomIndex = Math.floor(Math.random() * genericResponses.length);
                    response = genericResponses[randomIndex];
                    
                    // إضافة بعض الإجابات العامة
                    if (normalizedMessage.includes('سعر') || normalizedMessage.includes('تكلفة')) {
                        response += "أسعار العقارات تختلف حسب الموقع والمساحة وحالة العقار. بشكل عام، أسعار العقارات في الأحياء الراقية تبدأ من 4000 ريال للمتر المربع، بينما في الأحياء المتوسطة حوالي 2500-3500 ريال للمتر.";
                    } else if (normalizedMessage.includes('ايجار') || normalizedMessage.includes('استئجار')) {
                        response += "عند البحث عن عقار للإيجار، تأكد من فحص العقد جيداً ومعرفة ما إذا كانت الصيانة مشمولة أم لا. كما أنصح بالتحقق من وجود سياسة واضحة لتجديد العقد.";
                    } else if (normalizedMessage.includes('استثمار')) {
                        response += "الاستثمار العقاري يعتبر من أكثر الاستثمارات أماناً على المدى الطويل. أنصح بالبحث عن مناطق نامية حيث من المتوقع ارتفاع قيمة العقارات مستقبلاً.";
                    } else if (normalizedMessage.includes('تمويل') || normalizedMessage.includes('قرض')) {
                        response += "عند البحث عن تمويل عقاري، قارن بين عروض البنوك المختلفة من حيث نسبة الربح ومدة السداد. تذكر أن أقل نسبة ربح لا تعني دائماً أفضل صفقة إذا كانت مدة السداد أطول.";
                    } else {
                        response += "إذا كان لديك أسئلة محددة أكثر عن العقارات، يسعدني مساعدتك. يمكنك أيضاً الاطلاع على الاقتراحات في الشريط الجانبي للحصول على أفكار.";
                    }
                }
                
                // إضافة الرد
                addAIMessage(response);
            }, 1500); // تأخير لمحاكاة التفكير
        }
        
        // حساب مسافة ليفنشتاين (للمقارنة النصية)
        function levenshteinDistance(a, b) {
            const matrix = [];
            
            // تهيئة المصفوفة
            for (let i = 0; i <= b.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= a.length; j++) {
                matrix[0][j] = j;
            }
            
            // ملء المصفوفة
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) === a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1, // استبدال
                            matrix[i][j - 1] + 1,     // إدراج
                            matrix[i - 1][j] + 1      // حذف
                        );
                    }
                }
            }
            
            return matrix[b.length][a.length];
        }
        
        // إضافة استماع لزر الإرسال
        sendButton.addEventListener('click', () => {
            const message = messageInput.value.trim();
            
            if (message) {
                // إضافة رسالة المستخدم
                addUserMessage(message);
                
                // إرسال الرسالة إلى المستشار الذكي
                simulateAIResponse(message);
                
                // إفراغ حقل الإدخال
                messageInput.value = '';
            }
        });
        
        // إضافة استماع لضغط Enter
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendButton.click();
            }
        });
        
        // معالجة اقتراحات الأسئلة
        aiSuggestions.forEach(suggestion => {
            suggestion.addEventListener('click', () => {
                const query = suggestion.getAttribute('data-query');
                
                // إضافة السؤال المقترح في حقل الإدخال
                messageInput.value = query;
                
                // محاكاة النقر على زر الإرسال
                sendButton.click();
            });
        });
        
        // تبديل بين وضع الإضاءة والوضع المظلم
        modeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            
            // تبديل أيقونة الزر
            const icon = modeToggle.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
            
            // حفظ الإعدادات في التخزين المحلي
            localStorage.setItem('dark-mode', document.body.classList.contains('dark-mode'));
        });
        
        // تحقق مما إذا كان المستخدم يفضل الوضع المظلم
        if (localStorage.getItem('dark-mode') === 'true') {
            document.body.classList.add('dark-mode');
            const icon = modeToggle.querySelector('i');
            icon.classList.remove('fa-moon');
            icon.classList.add('fa-sun');
        }
        
        // التبديل بين قسم الاقتراحات وقسم العقارات
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                // إزالة الفئة النشطة من جميع الأزرار
                filterButtons.forEach(btn => btn.classList.remove('active'));
                
                // إضافة الفئة النشطة للزر المحدد
                button.classList.add('active');
                
                // إخفاء جميع الأقسام
                suggestionsSection.style.display = 'none';
                propertiesSection.style.display = 'none';
                
                // عرض القسم المطلوب
                const filter = button.getAttribute('data-filter');
                if (filter === 'suggestions') {
                    suggestionsSection.style.display = 'block';
                } else if (filter === 'properties') {
                    propertiesSection.style.display = 'block';
                }
            });
        });
        
        // معالجة زر العودة
        document.querySelector('.back-button').addEventListener('click', () => {
            window.history.back();
        });
        
        // معالجة أزرار عرض العقارات
        document.querySelectorAll('.view-property-btn').forEach(button => {
            button.addEventListener('click', function() {
                const propertyTitle = this.closest('.property-suggestion').querySelector('.property-title').textContent;
                alert(`سيتم توجيهك إلى صفحة تفاصيل العقار: ${propertyTitle}`);
                // يمكن استبدال هذا بكود فعلي للانتقال إلى صفحة العقار
            });
        });
        
        // معالجة أزرار السؤال عن العقارات
        document.querySelectorAll('.ask-about-btn').forEach(button => {
            button.addEventListener('click', function() {
                const propertyTitle = this.closest('.property-suggestion').querySelector('.property-title').textContent;
                messageInput.value = `أخبرني المزيد عن ${propertyTitle}`;
                sendButton.click();
            });
        });
    </script>
</body>
</html>
